async function register() {
            const name = document.getElementById('user-name').value.trim();
            const dob = document.getElementById('user-dob').value;
            if (!name || !dob) return alert("入力してください");
            
            // メールが空の場合は "" ではなく null を送るように調整
            const emailToSend = tempEmail || null;

            const res = await fetch('/api/save_user', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    userId, 
                    name, 
                    dob, 
                    email: emailToSend, 
                    auth_type: currentAuthType 
                })
            });

            if (res.ok) {
                initApp();
            } else {
                const data = await res.json();
                alert("登録エラー: " + (data.error || "サーバーで問題が発生しました"));
            }
        }
