<!DOCTYPE html>
<html lang="ja">
<head>
    <style>
        /* (å‰å›ã®CSSã‚’ç¶™æ‰¿ã—ã¤ã¤ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨ã®å¾®èª¿æ•´) */
        #selection-info { color: var(--gold); text-shadow: 0 0 5px rgba(212,175,55,0.5); font-style: italic; }
        .no-slots-msg { color: #888; font-size: 0.9rem; padding: 20px; border: 1px dashed #444; border-radius: 10px; }
    </style>
</head>
<body>
    <script>
        // ...æ—¢å­˜ã®å¤‰æ•°ã¯ãã®ã¾ã¾...

        async function selectDay(date, el) {
            selectedDate = date;
            document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            const slotsDiv = document.getElementById('time-slots');
            slotsDiv.innerHTML = "<div style='grid-column:1/4'>æ°´æ™¶ç‰ã«å•ã„ã‹ã‘ã¦ã„ã¾ã™...</div>";
            
            const res = await fetch(`/api/get_slots?castId=${currentCastId}&date=${date}`);
            const data = await res.json();
            
            if (data.slots && data.slots.length > 0 && !data.message) {
                slotsDiv.innerHTML = data.slots.map(s => 
                    `<button class="slot-btn" ${s.status==='booked'?'disabled':''} onclick="selectTime('${s.time}', this)">${s.time}</button>`
                ).join('');
            } else {
                // ğŸŒŸ æ ãŒãªã„æ™‚ã®å°è©ã‚’è¡¨ç¤º
                slotsDiv.innerHTML = `<div class="no-slots-msg" style="grid-column:1/4">${data.message || "ã“ã®æ—¥ã¯ãŠä¼‘ã¿ã‚’ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€‚"}</div>`;
            }
        }

        async function submitBooking() {
            // ğŸŒŸ äºˆç´„ç¢ºå®šæ™‚ã®ã€Œå„€å¼ã€ã®ã‚ˆã†ãªæ¼”å‡º
            const btn = document.getElementById('confirm-booking-btn');
            btn.disabled = true;
            btn.innerText = "é‹å‘½ã‚’åˆ»ã‚“ã§ã„ã¾ã™...";

            const res = await fetch('/api/reserve', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ userId, castId: currentCastId, scheduledAt: `${selectedDate}T${selectedTime}` })
            });

            // ğŸŒŸ æˆåŠŸæ™‚ã®å°è©
            alert(`ã€äºˆç´„å®Œäº†ã€‘\n\næ˜Ÿã€…ã®é…ç½®ãŒæ•´ã„ã¾ã—ãŸã€‚${selectedDate} ${selectedTime}ã€ã‚ãªãŸã®ãŸã‚ã®é‘‘å®šå®¤ã§ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚\n\nã€Œé‹å‘½ã‚’å¤‰ãˆã‚‹æº–å‚™ã¯ã€ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã€`);
            location.reload();
        }

        // ...ä»–ã®é–¢æ•°ã¯ãã®ã¾ã¾...
    </script>
</body>
</html>
