async function selectDay(date, el) {
            selectedDate = date;
            document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            const slotsDiv = document.getElementById('time-slots');
            slotsDiv.innerHTML = "<div style='grid-column:1/4; padding:20px;'>星に聞いています...</div>";
            document.getElementById('confirm-btn').style.display = 'none';

            const res = await fetch(`/api/get_slots?castId=${currentCastId}&date=${date}`);
            const data = await res.json();
            
            if (data.slots && data.slots.length > 0 && !data.message) {
                slotsDiv.innerHTML = data.slots.map(s => {
                    let btnText = s.time;
                    let isDisabled = false;
                    let opacity = "1.0";
                    let borderColor = "var(--gold)";
                    let color = "#fff";

                    if (s.status === 'booked') {
                        btnText = "予約済み";
                        isDisabled = true;
                        opacity = "0.4";
                        borderColor = "#555";
                        color = "#888";
                    } else if (s.status === 'past') {
                        // 過去の時間はさらに暗く
                        isDisabled = true;
                        opacity = "0.2";
                        borderColor = "#333";
                        color = "#555";
                    }

                    return `<button style="padding:10px; background:none; border:1px solid ${borderColor}; color:${color}; border-radius:5px; cursor:pointer; opacity:${opacity};" 
                            ${isDisabled ? 'disabled' : ''} 
                            onclick="selectTime('${s.time}', this)">${btnText}</button>`;
                }).join('');
            } else {
                slotsDiv.innerHTML = `<div style="grid-column:1/4; color:#888; padding:20px;">${data.message || "この日はお休みをいただいております。"}</div>`;
            }
        }
